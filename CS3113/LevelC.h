#include <vector>
#include "LevelB.h"

constexpr int LEVEL_WIDTH_C = 14,
              LEVEL_HEIGHT_C = 53;

class LevelC : public Scene {
private:
    unsigned int mLevelData[LEVEL_WIDTH_C * LEVEL_HEIGHT_C] = {
        22,  20,  20, 20,  20,  20,  4,  3, 20, 20, 20, 20, 20, 21,
        17,  30,  30, 30,  30,  30, 34, 35, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        1,    1,   1,  1,   1,   1,  8,  8,  1,  1,  1,  1,  1,  1,
        2,    2,   2,  2,   2,   2,  8,  8,  2,  2,  2,  2,  2,  2,
        1,    1,   1,  1,   1,   1,  8,  8,  1,  1,  1,  1,  1,  1,
        2,    2,   2,  2,   2,   2,  8,  8,  2,  2,  2,  2,  2,  2,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        1,    1,   1,  1,   1,   1,  8,  8,  1,  1,  1,  1,  1,  1,
        2,    2,   2,  2,   2,   2,  8,  8,  2,  2,  2,  2,  2,  2,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        1,    1,   1,  1,   1,   1,  8,  8,  1,  1,  1,  1,  1,  1,
        2,    2,   2,  2,   2,   2,  8,  8,  2,  2,  2,  2,  2,  2,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        1,    1,   1,  1,   1,   1,  8,  8,  1,  1,  1,  1,  1,  1,
        2,    2,   2,  2,   2,   2,  8,  8,  2,  2,  2,  2,  2,  2,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        1,    1,   1,  1,   1,   1,  8,  8,  1,  1,  1,  1,  1,  1,
        2,    2,   2,  2,   2,   2,  8,  8,  2,  2,  2,  2,  2,  2,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        1,    1,   1,  1,   1,   1,  8,  8,  1,  1,  1,  1,  1,  1,
        2,    2,   2,  2,   2,   2,  8,  8,  2,  2,  2,  2,  2,  2,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        1,    1,   1,  1,   1,   1,  8,  8,  1,  1,  1,  1,  1,  1,
        2,    2,   2,  2,   2,   2,  8,  8,  2,  2,  2,  2,  2,  2,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        17,  30,  30, 30,  30,  30,  4,  3, 30, 30, 30, 30, 30, 18,
        23,  19,  19, 19,  19,  19,  4,  3, 19, 19, 19, 19, 19, 24,
    };

   
    bool    mCarKeySpawned          = false;
    bool    mCarKeyCollected        = false;
    float   mCarKeySpawnOffset      = 200.0f;
    int     mPlayerMaxHealth        = 8;
    int     mPlayerCurrentHealth    = 8;
    float   mPlayerInvincibilityDuration = 0.75f;
    float   mPlayerInvincibilityTimer    = 0.0f;
    bool    mPlayerCanTakeDamage    = true;
    bool    mRecentlyExitedCar      = false;
    float   mCarExitCooldown        = 2.25f;
    float   mCarExitTimer           = 0.0f;

    std::vector<Entity*> mTrafficCars;
    std::vector<float>   mTrafficSpeeds;

public:
    static constexpr float  TILE_DIMENSION       = 100.0f,
                            END_GAME_THRESHOLD      = 800.0f,
                            CAR_SPEED              = 300.0f;

    Entity* playableCar = nullptr;
    std::vector<Entity*> mBarriers;
    std::vector<float>   mBarrierSpeeds;
    std::vector<float>   mBarrierMinX;
    std::vector<float>   mBarrierMaxX;
    Entity* carKey      = nullptr;
    LevelC();
    LevelC(Vector2 origin, const char *bgHexCode);
    ~LevelC();
    
    void initialise() override;
    void update(float deltaTime) override;
    void render() override;
    void shutdown() override;
    void exitCar();
};
